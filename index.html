<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mailchimp Magic ✨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2ecc71;
            --bg-dark: #1a1a1a;
            --card-bg-dark: #2d2d2d;
            --text-dark: #ffffff;
            --border-dark: #404040;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-dark);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        .card {
            background-color: var(--card-bg-dark);
            border: 1px solid var(--border-dark);
            margin-bottom: 20px;
        }

        .card-header {
            background-color: var(--card-bg-dark);
            border-bottom: 1px solid var(--border-dark);
            color: var(--text-dark);
        }

        .form-control {
            background-color: var(--bg-dark);
            border: 1px solid var(--border-dark);
            color: var(--text-dark);
        }

        .form-control:focus {
            background-color: var(--bg-dark);
            border-color: var(--primary-color);
            color: var(--text-dark);
            box-shadow: 0 0 0 0.25rem rgba(46, 204, 113, 0.25);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: #27ae60;
            border-color: #27ae60;
        }

        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .preview-frame {
            width: 100%;
            height: 600px;
            border: 1px solid var(--border-dark);
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            z-index: 1000;
            display: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--card-bg-dark);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .file-upload {
            position: relative;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .file-upload input[type="file"] {
            position: absolute;
            top: 0;
            right: 0;
            min-width: 100%;
            min-height: 100%;
            font-size: 100px;
            text-align: right;
            filter: alpha(opacity=0);
            opacity: 0;
            outline: none;
            cursor: pointer;
            display: block;
        }

        .error-message {
            color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            display: none;
        }

        .success-message {
            color: var(--primary-color);
            background: rgba(46, 204, 113, 0.1);
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            display: none;
        }

        .preview-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-refresh {
            background: var(--card-bg-dark);
            color: var(--text-dark);
            border: 1px solid var(--border-dark);
        }

        .btn-refresh:hover {
            background: var(--border-dark);
            color: var(--text-dark);
        }
    </style>
</head>

<body>
    <div class="container py-5">
        <h1 class="text-center mb-4">Mailchimp Magic ✨</h1>

        <div class="row">
            <!-- Input Section -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Input HTML</h5>
                    </div>
                    <div class="card-body">
                        <div class="file-upload">
                            <button class="btn btn-primary w-100 mb-2">
                                <i class="fas fa-upload"></i> Upload HTML File
                            </button>
                            <input type="file" id="fileInput" accept=".html,.htm" onchange="handleFileUpload(event)">
                        </div>
                        <textarea id="inputHtml" class="form-control" rows="10"
                            placeholder="Paste your Mailchimp HTML here..."></textarea>
                        <div class="error-message" id="inputError"></div>
                    </div>
                </div>
            </div>

            <!-- Output Section -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Output HTML</h5>
                    </div>
                    <div class="card-body">
                        <textarea id="outputHtml" class="form-control" rows="10" readonly></textarea>
                        <div class="preview-controls">
                            <button class="btn btn-primary" onclick="copyOutput()" id="copyButton">
                                <i class="fas fa-copy"></i> Copy Output
                            </button>
                            <button class="btn btn-primary" onclick="downloadOutput()">
                                <i class="fas fa-download"></i> Download
                            </button>
                        </div>
                        <div class="success-message" id="copySuccess">Output copied to clipboard! ✨</div>
                        <div class="error-message" id="outputError"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Magic Options -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">Magic Options ✨</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="removeFooter" checked>
                            <label class="form-check-label" for="removeFooter">Remove Footer</label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="removeSocial" checked>
                            <label class="form-check-label" for="removeSocial">Remove Social Media</label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="standardizeBg" checked>
                            <label class="form-check-label" for="standardizeBg">Standardize Background</label>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="removeLegacyFooter" checked>
                            <label class="form-check-label" for="removeLegacyFooter">Remove Legacy Footer</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Previews -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Input Preview</h5>
                    </div>
                    <div class="card-body">
                        <div class="loading-overlay" id="inputLoading">
                            <div class="spinner"></div>
                        </div>
                        <iframe id="inputPreview" class="preview-frame"></iframe>
                        <div class="preview-controls">
                            <button class="btn btn-preview" onclick="openPreview('input')">
                                <i class="fas fa-external-link-alt"></i> Open in New Tab
                            </button>
                            <button class="btn btn-preview btn-refresh" onclick="refreshPreview('input')">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Output Preview</h5>
                    </div>
                    <div class="card-body">
                        <div class="loading-overlay" id="outputLoading">
                            <div class="spinner"></div>
                        </div>
                        <iframe id="outputPreview" class="preview-frame"></iframe>
                        <div class="preview-controls">
                            <button class="btn btn-preview" onclick="openPreview('output')">
                                <i class="fas fa-external-link-alt"></i> Open in New Tab
                            </button>
                            <button class="btn btn-preview btn-refresh" onclick="refreshPreview('output')">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const inputHtml = document.getElementById('inputHtml');
        const outputHtml = document.getElementById('outputHtml');
        const inputPreview = document.getElementById('inputPreview');
        const outputPreview = document.getElementById('outputPreview');

        function showLoading(type) {
            document.getElementById(`${type}Loading`).style.display = 'flex';
            if (type === 'output') {
                document.getElementById('copyButton').disabled = true;
            }
        }

        function hideLoading(type) {
            document.getElementById(`${type}Loading`).style.display = 'none';
            if (type === 'output') {
                document.getElementById('copyButton').disabled = false;
            }
        }

        function showError(type, message) {
            const errorElement = document.getElementById(`${type}Error`);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 5000);
        }

        function showSuccess(type) {
            const successElement = document.getElementById(`${type}Success`);
            successElement.style.display = 'block';
            setTimeout(() => {
                successElement.style.display = 'none';
            }, 3000);
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    inputHtml.value = e.target.result;
                    processHtml();
                };
                reader.readAsText(file);
            }
        }

        function downloadOutput() {
            const content = outputHtml.value;
            const blob = new Blob([content], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'processed-newsletter.html';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function refreshPreview(type) {
            updatePreviews();
        }

        function processHtml() {
            showLoading('output');
            const options = {
                remove_footer: document.getElementById('removeFooter').checked,
                remove_social: document.getElementById('removeSocial').checked,
                standardize_bg: document.getElementById('standardizeBg').checked,
                remove_legacy_footer: document.getElementById('removeLegacyFooter').checked
            };

            // Process HTML client-side
            const parser = new DOMParser();
            const doc = parser.parseFromString(inputHtml.value, 'text/html');

            // Remove footer
            if (options.remove_footer) {
                const footer = doc.querySelector('[data-block-id="17"]');
                if (footer) footer.remove();
            }

            // Remove social media
            if (options.remove_social) {
                const socialSections = doc.querySelectorAll('a[href*="linkedin.com"]');
                socialSections.forEach(section => {
                    const parent = section.closest('td[style*="text-align: center"]');
                    if (parent) parent.remove();
                });
            }

            // Standardize background
            if (options.standardize_bg) {
                const elements = doc.querySelectorAll('[style*="background-color:#252525"]');
                elements.forEach(el => {
                    el.style.backgroundColor = 'white';
                });
            }

            // Remove legacy footer
            if (options.remove_legacy_footer) {
                const legacyFooter = doc.querySelector('td[style*="font-size: 12px"]');
                if (legacyFooter) legacyFooter.remove();
            }

            const processedHtml = doc.documentElement.outerHTML;
            outputHtml.value = processedHtml;
            hideLoading('output');
            updatePreviews();
        }

        function copyOutput() {
            outputHtml.select();
            document.execCommand('copy');
            showSuccess('copy');
        }

        function updatePreviews() {
            const inputDoc = inputPreview.contentDocument || inputPreview.contentWindow.document;
            const outputDoc = outputPreview.contentDocument || outputPreview.contentWindow.document;

            inputDoc.open();
            inputDoc.write(inputHtml.value);
            inputDoc.close();

            outputDoc.open();
            outputDoc.write(outputHtml.value);
            outputDoc.close();
        }

        function openPreview(type) {
            const preview = type === 'input' ? inputPreview : outputPreview;
            const win = window.open('', '_blank');
            win.document.write(preview.contentDocument.documentElement.outerHTML);
            win.document.close();
        }

        // Add event listeners
        inputHtml.addEventListener('input', processHtml);
        document.querySelectorAll('.form-check-input').forEach(input => {
            input.addEventListener('change', processHtml);
        });

        // Add keyboard shortcuts
        document.addEventListener('keydown', function (e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                processHtml();
            }
            if ((e.ctrlKey || e.metaKey) && e.key === 'c' && document.activeElement === outputHtml) {
                copyOutput();
            }
        });
    </script>
</body>

</html>